# author: Josh Washburn
# date created: 2-12-2021 
# version: 1.0
# purpose: disassociate all nsgs from all subnets and remove all nsgs from a subscription
###########################################################################################


# get nsgs that are not associated to anything


# disassociate all nsgs from all subnets and remove all nsgs from a subscription
$vnet = get-azvirtualnetwork
$subnets = foreach ($vn in $vnet) {Get-AzVirtualNetworkSubnetConfig -VirtualNetwork $vn}
foreach ($subnet in $subnets) {$subnet.NetworkSecurityGroup = $null}
foreach ($vn in $vnet) {Set-AzVirtualNetwork -VirtualNetwork $vn}
$nsgs = Get-AzNetworkSecurityGroup
foreach ($nsg in $nsgs) {Remove-AzNetworkSecurityGroup -Name $nsg.Name -ResourceGroupName $nsg.ResourceGroupName -Force}
